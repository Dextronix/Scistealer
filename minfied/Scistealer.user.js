// ==UserScript==
// @match      *://*/*
// @name         Sci-Stealer
// @run-at       document-end
// @require      http://code.jquery.com/jquery-3.3.1.min.js
// @require      https://cdn.jsdelivr.net/gh/Dextronix/Scistealer@master/unpaywall.js
// @version      0.1
// @description  Increases access to knowledge
// @author       Dextronix
// @grant        GM.setValue
// @grant        GM.getValue
// @grant        GM.deleteValue
// ==/UserScript==
//
var settings,doi,Mdoi,myHost=window.location.href,docAsStr=document.documentElement.innerHTML,allSources=[],ua=navigator.userAgent.toLowerCase(),isAndroid=-1<ua.indexOf("android"),scihub_URL=["sci-hub.ren","sci-hub.fun","sci-hub.mu","sci-hub.se","sci-hub.tw","sci-hub.shop","sci-hub.ooo","sci-hub.ga","sci-hub.nz","sci-hub.is","sci-hub.la","80.82.77.83","80.82.77.84"],proxies=["www.croxyproxy.com/","hide.me/en/proxy","www.proxysite.com/"],defaultsettings={scihubURL:"4",scihubproxy:"true",bookscproxy:"true",autoclick:"false",prefproxy:"2",urlblacklist:["youtube.com","reddit.com","google.com"]},datex=new Date,THISYEAR=datex.getFullYear();(async()=>{settings=await GM.getValue("SS_SETTINGS");let a=await GM.getValue("SS_TITLE"),b=await GM.getValue("SS_PROXY");if(Mdoi=await GM.getValue("SS_DOI"),null==settings&&(GM.setValue("SS_SETTINGS",defaultsettings),settings=defaultsettings),!1==isblacklisted()){if((-1<window.location.href.indexOf("booksc.xyz")||0<$("#searchFormWithLogo").length)&&($(window).scrollTop($("*:contains("+a+"):last").offset().top),$("*:contains("+a+"):last").css("background-color","#FFFF00"),GM.deleteValue("SS_TITLE")),0<myHost.indexOf(proxies[0])&&b){var c=$("input[placeholder='Enter an URL or a search query to access']"),d=$("#requestSubmit");c.val(b),1==settings.autoclick&&d.click(),GM.deleteValue("SS_PROXY")}if(0<myHost.indexOf(proxies[1])&&b){var c=$("input[placeholder='Enter web address']"),d=$("#hide_register_save");c.val(b),1==settings.autoclick&&d.click(),GM.deleteValue("SS_PROXY")}if(0<myHost.indexOf(proxies[2])&&b){var c=$("input[placeholder='Enter Url']");c.val(b),1==settings.autoclick&&c.next().click(),GM.deleteValue("SS_PROXY")}void 0===Mdoi?doi=findDoi():(doi=Mdoi,GM.deleteValue("SS_DOI")),void 0!==doi&&CreateMenu()}})();function ManualDOI(){var a=$("#manualDOI").val();GM.setValue("SS_DOI",a),location.reload()}function Goback(){location.reload()}function Add_Options(){for(var a=0;a<scihub_URL.length;a++){var b=document.getElementById("scihubURL"),c=document.createElement("option");c.text=scihub_URL[a],c.value=a,b.add(c)}}function LoadSets(){$("#sci-hub_proxy").prop("checked",JSON.parse(settings.scihubproxy)),$("#booksc_proxy").prop("checked",JSON.parse(settings.bookscproxy)),$("#autoclick_btn").prop("checked",JSON.parse(settings.autoclick)),$("#proxy_pref").val(settings.prefproxy).trigger("change"),$("#scihubURL").val(settings.scihubURL).trigger("change"),$("#blockedurls").val(settings.urlblacklist),$("#progversion").text("Version "+GM_info.script.version)}function SaveSets(){var a=settings||defaultsettings;a.scihubproxy=$("#sci-hub_proxy").prop("checked"),a.bookscproxy=$("#booksc_proxy").prop("checked"),a.autoclick=$("#autoclick_btn").prop("checked"),a.prefproxy=$("#proxy_pref").val(),a.scihubURL=$("#scihubURL").val();var b=$("#blockedurls").val(),c=b.split(",");a.urlblacklist=c,GM.setValue("SS_SETTINGS",a),location.reload()}function SettingsPage(){document.body.innerHTML="",document.head.innerHTML="",document.title="Settings",document.body.innerHTML="<meta charset=\"utf-8\"/><html> <body> <style>input{margin: 10px}select{font-size: 15px;padding: 2px;-webkit-appearance: none;-moz-appearance: none;appearance: none;margin: 10px;background: #fff;color: #000;outline: 0}h1{text-align: center;}.subhead{color: #818384;position: relative;top: -25px;font-size: 20px;}.blacklist{resize: none;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box}.content{margin: auto;width: 60%;border: 3px solid #000;max-width: 400px;margin: auto;padding: 15px;background: #c3deb7;padding: 1px}</style> <div class=\"content\"> <h1 class=\"heading\">Sci-stealer Settings</h1> <h1 id=\"progversion\" class=\"subhead\">Version X</h1> <div class=\"proxystuff\"> <input type=\"checkbox\" id=\"sci-hub_proxy\"></input> Use Proxy for scihub<br><input type=\"checkbox\" id=\"booksc_proxy\"></input> Use Proxy for booksc<br><input type=\"checkbox\" id=\"autoclick_btn\"></input> Autoclick proxy button<br><a>proxy to use:</a> <select id=\"proxy_pref\"> <option value=\"0\">Croxyproxy</option> <option value=\"1\">Hide.me</option> <option value=\"2\">Proxysite</option> </select><br><a>sci-hub url:</a> <select id=\"scihubURL\"></select> <br><a>Blocked URLs:</a> <textarea id=\"blockedurls\" class=\"blacklist\" rows=\"4\" cols=\"30\"></textarea> <br><a>Manual DOI search:</a> <input type=\"text\" id=\"manualDOI\"><input type=\"submit\" id=\"loadmanual\" value=\"Load\"> </div><input class=\"imspecial\" type=\"submit\" id=\"savebtn\" value=\"Save\"> <input class=\"imspecial\" type=\"submit\" id=\"backbtn\" value=\"Go back\"> </div></body></html>",document.getElementById("savebtn").onclick=function(){SaveSets()},document.getElementById("loadmanual").onclick=function(){ManualDOI()},document.getElementById("backbtn").onclick=function(){Goback()},Add_Options(),LoadSets()}function isblacklisted(){for(var a=0;a<settings.urlblacklist.length;a++)if(-1<window.location.href.indexOf(settings.urlblacklist[a]))return!0;return!1}function SavePaperDate(a){$.getJSON("https://api.crossref.org/v1/works/"+a,function(a){GM.setValue("SS_TITLE",a.message.title)})}function SaveTitle(a){$.getJSON("https://api.oadoi.org/v2/"+a+"?email=unpaywall@impactstory.org",function(a){GM.setValue("SS_TITLE",a.title),GM.setValue("SS_YEAR",a.year)})}function HandleURL(a,b){!0==settings.scihubproxy&&"scihub"==b?(GM.setValue("SS_PROXY",a),window.open("http://"+proxies[settings.prefproxy])):!0==settings.bookscproxy&&"booksc"==b?(GM.setValue("SS_PROXY",a),window.open("http://"+proxies[settings.prefproxy])):window.open(a)}function open_Booksc(){SaveTitle(doi);var a=`https://booksc.xyz/s/?q=${doi.replace("/","%2F")}&t=0`;HandleURL(a,"booksc")}function open_Sci_hub(){(SS_YEAR=THISYEAR)?HandleURL(`http://${scihub_URL[settings.scihubURL]}/${document.URL}`,"scihub"):HandleURL(`http://${scihub_URL[settings.scihubURL]}/${doi}`,"scihub")}function CreateMenu(){document.body.innerHTML+=!0==isAndroid?"<style>.SnippetBaseContainer{position:fixed;z-index:9999;bottom:0;left:0;right:0;background-color:#fff;color:#0c0c0d;font-size:14px;line-height:20px;border-top:1px solid transparent;box-shadow:0 1px 10px 0 rgba(12,12,13,.2);display:flex;align-items:center}.SnippetBaseContainer .innerWrapper{margin:0 auto;display:flex;align-items:center;padding:12px 0;padding-inline-end:36px;max-width:836px}.ASRouterButton{font-weight:600;font-size:14px;white-space:nowrap;border-color:#4caf50;border-radius:2px;font-family:inherit;padding:8px 15px;margin-inline-start:12px;color:#000;cursor:pointer}.close .ASRouterButton{border-color:red;color:#000}.settings .ASRouterButton{border-color:#00f;color:#000}</style><div class=SnippetBaseContainer id=notey10> <div class=innerWrapper> <div class=settings><button class=ASRouterButton id=sets_elm>\u2699\uFE0F</button></div><div><button class=ASRouterButton id=scihub_elm>HUB</button></div><div><button class=ASRouterButton id=booksc_elm>BSC</button></div><div class=close><button class=ASRouterButton onclick='document.getElementById(\"notey10\").style.display=\"none\"'>\u274C</button></div></div></div>":"<style>.SnippetBaseContainer{position:fixed;z-index:9999;bottom:0;left:0;right:0;background-color:#fff;color:#0c0c0d;font-size:14px;line-height:20px;border-top:1px solid transparent;box-shadow:0 1px 10px 0 rgba(12,12,13,.2);display:flex;align-items:center}.SnippetBaseContainer .innerWrapper{margin:0 auto;display:flex;align-items:center;padding:12px 25px;padding-inline-end:36px;max-width:836px}.ASRouterButton{font-weight:600;font-size:14px;white-space:nowrap;border-color:#4caf50;border-radius:2px;font-family:inherit;padding:8px 15px;margin-inline-start:12px;color:#000;cursor:pointer}.close .ASRouterButton{position:relative;border-color:red;color:#000;right:15px}.settings .ASRouterButton{border-color:#00f;color:#000}</style><div class=SnippetBaseContainer id=notey10><div class=settings><button class=ASRouterButton id=sets_elm>Settings</button></div><div class=innerWrapper><div><p class=body><span>Paper Search:</span></div><div><button class=ASRouterButton id=scihub_elm>Sci-hub.tw</button></div><div><button class=ASRouterButton id=booksc_elm>Booksc.xyz</button></div></div><div class=close><button class=ASRouterButton onclick='document.getElementById(\"notey10\").style.display=\"none\"'>Close</button></div></div>",$("#scihub_elm").html(scihub_URL[settings.scihubURL]),$(".ASRouterButton").click(function(){var a=$(this).attr("id");switch(a){case"booksc_elm":open_Booksc();break;case"scihub_elm":open_Sci_hub();break;case"sets_elm":SettingsPage();break;default:}})}